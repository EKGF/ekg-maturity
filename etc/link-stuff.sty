%
% All bookmarks, cross-references, hyperlink related stuff
%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{link-stuff}[2019/09/16 agnos.ai - all link related stuff]

\RequirePackage{index-stuff} % imakeidx needs to be loaded before hyperref (to make links in the index pages work)

\RequirePackage{bookmark}
\RequirePackage{appendix}

\RequirePackage{overleaf-stuff}
\ifx\notRunningOnOverleaf % For some reason xurl.sty cannot be loaded by Overleaf
  \RequirePackage{xurl}% has to be loaded before the hyperref package
\fi

\RequirePackage{hyperref}
\hypersetup{colorlinks=true, linkcolor=darkgray, citecolor=darkgray, filecolor=darkgray, urlcolor=darkgray, plainpages=false, unicode}
\RequirePackage{nameref}
\RequirePackage{csquotes}
\RequirePackage[american]{babel}
\RequirePackage{import}
\RequirePackage{parskip}
\RequirePackage{subcaption}
\RequirePackage{wrapfig}
\RequirePackage{floatflt}
\RequirePackage{xargs}
\RequirePackage{etoolbox}
\RequirePackage{xparse}

\makeatletter
\newcommand{\iflabelexists}[3]{\@ifundefined{r@#1}{#3}{#2}}
\makeatother

%
% Get the name of the current chapter/section/subsection/etc (without the number)
%
\makeatletter
\newcommand*{\currentname}{\@currentlabelname\xspace} % depends on package nameref
\makeatother

%
% Produce a reference to another chapter in another "book". If that chapter is available in the same book then
% the link works and shows a page number. If it isn't then it just shows the name of the chapter and the name of the
% book.
%
% Use as follows:
%
% blah blah (see \chapterref{pt:ekg-mm}{Maturity Model}{\glsfmtshort{kgmethod}})
%
\newcommand{\chapterref}[3]{%
  \iflabelexists{#1}{%
    chapter \ref{#1}, \Nameref{#1}\xspace%
  }{%
    chapter "#2" of the #3-document\xspace%
  }%
}
